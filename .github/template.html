<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HC News - {{DATE}}</title>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            line-height: 1.5;
            max-width: 800px;
            margin: 0 auto;
        }
        .controls {
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #333;
            display: flex;
            gap: 10px;
            position: sticky;
            bottom: 0;
            background-color: #1e1e1e;
            z-index: 100;
            padding-bottom: 10px;
        }
        button {
            background-color: #3794ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        button:hover { background-color: #2a75d1; }
        button.secondary { background-color: #333; color: #ccc; }
        button.secondary:hover { background-color: #444; }
        button.active { outline: 2px solid #fff; }
        
        #raw-content {
            width: 100%;
            height: 80vh;
            background-color: #2d2d2d;
            color: #d4d4d4;
            border: 1px solid #444;
            padding: 15px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            resize: vertical;
            display: none;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        #rich-content {
            white-space: pre-wrap;
            font-size: 16px;
        }
        
        /* WhatsApp style formatting */
        strong { color: #fff; font-weight: bold; }
        em { font-style: italic; color: #aaa; }
        del { text-decoration: line-through; color: #888; }
        a { color: #3794ff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        code { 
            background-color: #2d2d2d; 
            padding: 2px 4px; 
            border-radius: 3px; 
            font-family: 'Courier New', monospace;
            color: #e06c75;
        }
    </style>
</head>
<body>
    <div id="rich-content"></div>
    <textarea id="raw-content" readonly></textarea>

    <div class="controls">
        <button onclick="setView('rich')" id="btn-rich">Rich View</button>
        <button onclick="setView('raw')" id="btn-raw" class="secondary">Raw Text</button>
        <button onclick="copyRaw()" class="secondary">Copy Text</button>
    </div>

    <!-- Hidden container for the original injected content -->
    <script id="source-content" type="text/plain">
{{CONTENT}}
    </script>

    <script>
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function parseWhatsApp(text) {
            // 1. Escape HTML first to prevent injection
            let parsed = escapeHtml(text);

            // 2. Code blocks (```text```)
            parsed = parsed.replace(/```([^`]+)```/g, '<pre><code>$1</code></pre>');

            // 3. Inline code (`text`)
            parsed = parsed.replace(/`([^`]+)`/g, '<code>$1</code>');

            // 4. Bold (*text*)
            parsed = parsed.replace(/\*([^*]+)\*/g, '<strong>$1</strong>');

            // 5. Italic (_text_)
            parsed = parsed.replace(/_([^_]+)_/g, '<em>$1</em>');

            // 6. Strikethrough (~text~)
            parsed = parsed.replace(/~([^~]+)~/g, '<del>$1</del>');

            // 7. Links (http/https)
            // Simple regex for URLs
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            parsed = parsed.replace(urlRegex, '<a href="$1" target="_blank">$1</a>');

            return parsed;
        }

        function setView(view) {
            const richDiv = document.getElementById('rich-content');
            const rawArea = document.getElementById('raw-content');
            const btnRich = document.getElementById('btn-rich');
            const btnRaw = document.getElementById('btn-raw');

            if (view === 'rich') {
                richDiv.style.display = 'block';
                rawArea.style.display = 'none';
                btnRich.classList.remove('secondary');
                btnRaw.classList.add('secondary');
            } else {
                richDiv.style.display = 'none';
                rawArea.style.display = 'block';
                btnRich.classList.add('secondary');
                btnRaw.classList.remove('secondary');
            }
        }

        function copyRaw() {
            const rawText = document.getElementById('raw-content');
            // If hidden, we can't select it easily, so temporarily show it or use clipboard API directly
            const wasHidden = rawText.style.display === 'none';
            if (wasHidden) {
                rawText.style.display = 'block';
                rawText.style.opacity = '0';
                rawText.style.position = 'absolute';
            }
            
            rawText.select();
            rawText.setSelectionRange(0, 99999); // For mobile devices
            
            navigator.clipboard.writeText(rawText.value).then(() => {
                const btn = document.querySelector('button[onclick="copyRaw()"]');
                const originalText = btn.innerText;
                btn.innerText = "Copied!";
                setTimeout(() => btn.innerText = originalText, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            }).finally(() => {
                if (wasHidden) {
                    rawText.style.display = 'none';
                    rawText.style.opacity = '';
                    rawText.style.position = '';
                }
            });
        }

        // Initialize
        window.onload = function() {
            const rawText = document.getElementById('source-content').textContent;
            // Trim the first newline if it exists (due to script tag formatting)
            const cleanText = rawText.replace(/^\n/, '');
            
            document.getElementById('raw-content').value = cleanText;
            document.getElementById('rich-content').innerHTML = parseWhatsApp(cleanText);
        };
    </script>
</body>
</html>
